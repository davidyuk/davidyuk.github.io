{"version":3,"file":"js/page-redeem.524ff054.js","mappings":"+JAAA,IAAIA,EAAS,WAAkB,IAAIC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAQF,EAAII,KAAMF,EAAG,MAAM,CAACG,YAAY,WAAW,CAACH,EAAG,cAAc,GAAGA,EAAG,OAAO,CAACG,YAAY,iBAAiBC,MAAM,CAAC,cAAc,UAAU,kBAAkB,CAAEC,KAAM,YAAa,yBAAyB,UAAU,CAACL,EAAG,QAAQ,CAACI,MAAM,CAAC,KAAO,SAAS,SAAWN,EAAIQ,GAAG,kCAAkCC,KAAK,WAAWP,EAAG,MAAM,CAACG,YAAY,eAAe,CAACH,EAAG,OAAO,CAACF,EAAIU,GAAGV,EAAIW,GAAGX,EAAIQ,GAAG,oCAAoCN,EAAG,UAAU,CAACI,MAAM,CAAC,QAAUN,EAAIY,YAAY,GAAGZ,EAAIa,GAAIb,EAAIc,UAAU,SAASC,GAAS,OAAOb,EAAG,kBAAkBF,EAAIgB,GAAG,CAACC,IAAIF,EAAQG,QAAQZ,MAAM,CAAC,cAAc,IAAIa,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOpB,EAAIqB,cAAcN,EAAQG,QAAQ,IAAI,kBAAkBH,GAAQ,GAAO,CAACb,EAAG,WAAW,CAACI,MAAM,CAAC,KAAO,SAASG,KAAK,WAAW,EAAE,KAAI,EAC1zB,EACIa,EAAkB,G,+MCkDtB,GACA,YACA,cACA,SACA,UACA,YACA,oBACA,cAEA,WACA,aACA,UACA,UAEA,gBACA,yDACA,EACA,wDACA,iBACA,UACA,cACA,UAGA,OAFA,uCACA,6CAEA,CAEA,YAVA,EAWA,EACA,SACA,2DACA,MACA,yCACA,kBACA,6CAGA,IACA,iBACA,WACA,WACA,YACA,CAEA,iBAKA,kBAJA,iCACA,aACA,sDAKA,4DACA,0DACA,iBACA,qBACA,iCACA,aACA,gDAKA,qCAjCA,EAkCA,EACA,+DACA,UACA,wCACA,iBACA,SACA,wDACA,iDAHA,CAKA,8BAEA,mBACA,kCACA,iCACA,oBACA,kBACA,oCACA,GAhBA,EAiBA,ICtIsQ,I,WCQlQC,GAAY,OACd,EACAxB,EACAuB,GACA,EACA,KACA,WACA,MAIF,EAAeC,EAAiB,O","sources":["webpack://aepp-base/./src/pages/mobile/RedeemBalance.vue","webpack://aepp-base/src/pages/mobile/RedeemBalance.vue","webpack://aepp-base/./src/pages/mobile/RedeemBalance.vue?5fff","webpack://aepp-base/./src/pages/mobile/RedeemBalance.vue?f789"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return (_vm.busy)?_c('div',{staticClass:\"spinner\"},[_c('AeSpinner')],1):_c('Page',{staticClass:\"redeem-balance\",attrs:{\"header-fill\":\"neutral\",\"right-button-to\":{ name: 'transfer' },\"right-button-icon-name\":\"close\"}},[_c('Guide',{attrs:{\"slot\":\"header\",\"template\":_vm.$t('transfer.redeem-balance.guide')},slot:\"header\"}),_c('div',{staticClass:\"balance-row\"},[_c('span',[_vm._v(_vm._s(_vm.$t('transfer.send.amount.balance')))]),_c('Balance',{attrs:{\"balance\":_vm.balance}})],1),_vm._l((_vm.accounts),function(account){return _c('ListItemAccount',_vm._b({key:account.address,attrs:{\"border-dark\":\"\"},on:{\"click\":function($event){return _vm.sendToAccount(account.address)}}},'ListItemAccount',account,false),[_c('LeftMore',{attrs:{\"slot\":\"right\"},slot:\"right\"})],1)})],2)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div\n    v-if=\"busy\"\n    class=\"spinner\"\n  >\n    <AeSpinner />\n  </div>\n  <Page\n    v-else\n    header-fill=\"neutral\"\n    :right-button-to=\"{ name: 'transfer' }\"\n    right-button-icon-name=\"close\"\n    class=\"redeem-balance\"\n  >\n    <Guide\n      slot=\"header\"\n      :template=\"$t('transfer.redeem-balance.guide')\"\n    />\n\n    <div class=\"balance-row\">\n      <span>{{ $t('transfer.send.amount.balance') }}</span>\n      <Balance :balance=\"balance\" />\n    </div>\n\n    <ListItemAccount\n      v-for=\"account in accounts\"\n      :key=\"account.address\"\n      border-dark\n      v-bind=\"account\"\n      @click=\"sendToAccount(account.address)\"\n    >\n      <LeftMore slot=\"right\" />\n    </ListItemAccount>\n  </Page>\n</template>\n\n<script>\nimport { pick } from 'lodash-es';\nimport BigNumber from 'bignumber.js';\nimport {\n  Ae, Transaction, Crypto, TxBuilderHelper,\n} from '@aeternity/aepp-sdk';\nimport { handleUnknownError } from '../../lib/utils';\nimport AeSpinner from '../../components/AeSpinner.vue';\nimport Page from '../../components/Page.vue';\nimport Guide from '../../components/Guide.vue';\nimport Balance from '../../components/Balance.vue';\nimport ListItemAccount from '../../components/ListItemAccount.vue';\nimport { LeftMore } from '../../components/icons';\nimport { MAGNITUDE } from '../../lib/constants';\nimport { MIN_SPEND_TX_FEE } from '../../lib/spendTxFees';\n\nexport default {\n  components: {\n    AeSpinner,\n    Page,\n    Guide,\n    Balance,\n    ListItemAccount,\n    LeftMore,\n  },\n  data: () => ({\n    keypair: null,\n    balance: 0,\n    busy: true,\n  }),\n  subscriptions() {\n    return pick(this.$store.state.observables, ['accounts']);\n  },\n  async mounted() {\n    while (!this.keypair) {\n      try {\n        await this.readQrCode(); // eslint-disable-line no-await-in-loop\n      } catch (error) {\n        this.$router.push({ name: 'transfer' });\n        if (error.message !== 'Cancelled by user') handleUnknownError(error);\n        return;\n      }\n    }\n    this.busy = false;\n  },\n  methods: {\n    async readQrCode() {\n      let privateKey;\n      privateKey = await this.$store.dispatch('modals/open', {\n        name: 'readQrCode',\n        title: this.$t('transfer.redeem-balance.scan'),\n      });\n\n      try {\n        privateKey = Buffer.from(privateKey, 'hex');\n      } catch (error) {\n        handleUnknownError(error);\n        privateKey = Buffer.from([]);\n      }\n\n      if (privateKey.length !== 64) {\n        await this.$store.dispatch('modals/open', {\n          name: 'alert',\n          text: this.$t('transfer.redeem-balance.wrong-qr-code'),\n        });\n        return;\n      }\n\n      const address = TxBuilderHelper.encode(Crypto.generateKeyPairFromSecret(privateKey).publicKey, 'ak');\n      this.balance = BigNumber(await this.$store.state.sdk.getBalance(address))\n        .shiftedBy(-MAGNITUDE);\n      if (this.balance < MIN_SPEND_TX_FEE) {\n        await this.$store.dispatch('modals/open', {\n          name: 'alert',\n          text: this.$t('transfer.redeem-balance.no-funds'),\n        });\n        return;\n      }\n\n      this.keypair = { address, privateKey };\n    },\n    async sendToAccount(accountTo) {\n      this.busy = true;\n      const { hash, tx: { amount } } = await (\n        await Ae.compose(Transaction, {\n          methods: {\n            sign: (data) => Promise.resolve(Crypto.sign(data, this.keypair.privateKey)),\n            address: () => Promise.resolve(this.keypair.address),\n          },\n        })({ url: this.$store.state.sdkUrl })\n      )\n        .transferFunds(1, accountTo);\n      this.$router.push({ name: 'transfer' });\n      this.$store.dispatch('modals/open', {\n        name: 'spendSuccess',\n        transactionHash: hash,\n        amount: BigNumber(amount).shiftedBy(-MAGNITUDE),\n      });\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n@import '../../styles/typography';\n\n.spinner {\n  flex-grow: 1;\n  display: flex;\n\n  .ae-spinner {\n    margin: auto;\n  }\n}\n\n.redeem-balance .balance-row {\n  display: flex;\n  justify-content: space-between;\n  @extend %face-sans-base;\n}\n</style>\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./RedeemBalance.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-39.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./RedeemBalance.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./RedeemBalance.vue?vue&type=template&id=15cb73e8&scoped=true&\"\nimport script from \"./RedeemBalance.vue?vue&type=script&lang=js&\"\nexport * from \"./RedeemBalance.vue?vue&type=script&lang=js&\"\nimport style0 from \"./RedeemBalance.vue?vue&type=style&index=0&id=15cb73e8&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"15cb73e8\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","busy","staticClass","attrs","name","$t","slot","_v","_s","balance","_l","accounts","account","_b","key","address","on","$event","sendToAccount","staticRenderFns","component"],"sourceRoot":""}